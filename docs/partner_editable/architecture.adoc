This Quick Start will deploy resources based on the deployment type (Virtual or Physical). The resources that will be deployed for both deployment types are shown in the 2 architecture diagrams below and outlined in the dotted orange box.

Deploying the *VIRTUAL* deployment option of the Quick Start with *default parameters* builds the following _{partner-product-name}_ environment in the AWS Cloud.


// Replace this example diagram with your own. Send us your source PowerPoint file. Be sure to follow our guidelines here : http://(we should include these points on our contributors giude)
//[#architecture1]
.Quick Start architecture (Virtual Deployment) for _{partner-product-name}_ on AWS
//[link=images/architecture_diagram.png]
//image::../images/architecture_diagram.png[Architecture,width=648,height=439]
image::../images/IMCQuickStartArchitecture-Virtual.png[Architecture,width=648,height=439]

As shown in the figure above, the virtual deployment of the Quick Start sets up the following resources:

. *VPC:* The IMC Quick Start can be launched in an existing default VPC or can generate a new VPC within which 2 EC2 instances are launced within a single availability zone and subnet.
. *AWS IoT Greengrass:* A Greengrass group is provisioned and deployed to the the edge gateway device (physical device or simulated with EC2 instance). This Greengrass group is configurable during cloudformation stack launch to include a SiteWise connector that will connect to the OPC UA server of the partner edge application (i.e. Igntiion Server or KEPServerEX). The Greengrass core deployed to the edge device can be configured to route data throug the SiteWise connector to AWS IoT SiteWise or via MQTT to AWS IoT Core's message broker.
. *AWS IoT Core:* AWS IoT Core can receive and route MQTT messages originatinng from both the partner edge software application (i.e. Ignition Server or KEPServerEX) or from the Greengrass core. These messages may conntain the telemetry values of the PLC tags generated by the edge devices (PLCs). In the case that the Cirrus Link Driver for the AMC is configured, AWS IoT Core routes messages containing the asset hierarchy (metadata) for tags defined within Ignition Server runnign at the edge to the AMC where they are mapped into the appropriate resources within AWS IoT SiteWise.
. *AWS IoT SiteWise:* This service maintains the industrial machine asset hierarchy information and contains a managed time series database to store all data generted by these industrial assets. It also inncludes a SaaS dashboard building service called Monitor. Monitor allows users to build custom dashboards for near real-time data visualization. The AMC maps asset hiearchy data (i.e. Plant/Line/Machine/Tag) into SiteWise automatically as part of the IMC cloudformation stack launch.
. *Kinesis to S3:* Amazon Kinesis Data Firehose routes data messages from AWS IoT Core into an S3 bucket where they are stored and made available for analysis by services like Amazon QuickSight.
. *QuickSight:* Amazon QuickSight enables users to build custom business intelligence dashboards and visualizations for data that is routed to and stored in the S3 datalake. The IMC Quick Start provides a simple data ingest route to S3 by default. Users can easily adapt and extend this basic framework to suit their individual needs.
. *Asset Model Converter (AMC):* The AMC is a serverless workflow that ingests asset hierarchy definition files/messages generated by the partner edge applications and converts them into a schema compatible with AWS IoT SiteWise's asset model definition schema. The AMC automatically generates asset models within sitewise, creates unique assets from those models and then links all assets together in a well-defined hierarchy that mirrors the industrial assets at the customer facility (i.e. factory/lines/machines/tags). The AMC was designed to enable additional partner edge applications to be integrated with it with minimal effort. The AMC architecture diagram is shown in more detail below. 

For deployments in real customer environments, users will deploy the *PHYSICAL* deployment type of the IMC Quick Start. The key difference from the *VIRTUAL* deployment type (shown above) is that the AWS IoT Greengrass Core is running on a physical industrial PC device at the customer's facility.

.Quick Start architecture (Physical Deployment) for _{partner-product-name}_ on AWS
//[link=images/architecture_diagram.png]
//image::../images/architecture_diagram.png[Architecture,width=648,height=439]
image::../images/IMCQuickStartArchitecture-Physical.png[Architecture,width=648,height=439]

As shown in the figure above, the physical deployment of the Quick Start deploys the same resources as the virtual deployment but with the following differences:

* There is no EC2 instances launched in a VPC in the AWS cloud. Instead, AWS IoT Greengrass is installed (via a bootstrap installation script that is provided as part of the CloudFormation stack launch) directly onto the industrial PC hardware running in the customer's facility.
* Edge applications (i.e. Ignition Serve, KEPServerEX, etc.) communicate with PLCs, historians, databases and IoT devices running in the customer facility.
* The user can choose to connnect to either Ignition Server or KEPServerEX depending on what the customer user case requires.
* The rest of the resources remain the same as those in the virtual deployment type.

A key component of the IMC Quick Start is the Asset Model Converter (AMC). The AMC architecture is responsible for converting the asset hierarchy information defined within the edge appication (i.e. Ignition Server, KEPServerEX, etc.) and provisioning the matching asset hierarchy in SiteWise. The AMC architecture is shown below and includes a sequence flow for the SiteWise resource provisioning.

.Asset Model Converter (AMC) architecture diagram
//[link=images/architecture_diagram.png]
//image::../images/architecture_diagram.png[Architecture,width=648,height=439]
image::../images/AMCArchitecture.png[Architecture,width=648,height=439]

The table below details the AMC sequence flow:

[cols="2,4a,8a"]
.AMC Sequence Flow
|===
|*Step*
|*Activity*
|*Description*

|1(a)
|Upload Path 1
|Automated AMC asset hierarchy ingest

|1(b)
|Upload Path 2
|Manual AMC file definition upload to S3 upload

|2
|Ingest Lambda
|Ingest Lambda routes tag definition payloads into S3 bucket
Source: functions/source/AssetModelIngestion/assetModelIngestion.py

|3
|Object upload event
|Object upload event triggers Conversion/Provisioning lambda

|4
|Asset hierarchy conversion
|Convert input asset hierarchy definition to DynamoDB table items (conforming to SiteWise asset model and asset definition structure)

|5
|SiteWise resource provisioning
|Provision resources in SiteWise based on updated DynamoDB table items
Source: functions/source/AssetModelConverter/createSitewiseResources.py

|===


